CREATE PROCEDURE CrearNuevoPedido
    @CustomerID NCHAR(5),
    @EmployeeID INT,
    @ProductID INT,
    @Cantidad INT
AS
BEGIN
    BEGIN TRY 
        BEGIN TRANSACTION;


        -- 1. Insertamos un nuevo pedido en Orders
        DECLARE @NuevoOrderID INT;

        INSERT INTO Orders (CustomerID, EmployeeID, OrderDate, RequiredDate, ShipVia, Freight)
        VALUES (@CustomerID, @EmployeeID, GETDATE(), DATEADD(DAY, 7, GETDATE()), 1, 10);

        -- Guardamos el ID generado
        SET @NuevoOrderID = SCOPE_IDENTITY();

        -- 2. Insertamos en Order Details
        INSERT INTO [Order Details] (OrderID, ProductID, UnitPrice, Quantity, Discount)
        SELECT @NuevoOrderID, @ProductID, UnitPrice, @Cantidad, 0
        FROM Products
        WHERE ProductID = @ProductID;

        -- 3. Confirmamos todo
        COMMIT TRANSACTION;
        PRINT 'Pedido creado correctamente.';
    END TRY

    BEGIN CATCH
        -- Si ocurre un error, revertimos
        ROLLBACK TRANSACTION;
        PRINT 'Error: no se pudo crear el pedido.';
    END CATCH
END;
